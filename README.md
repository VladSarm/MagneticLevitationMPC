# MagneticLevitationMPC

This project demonstrates a Model Predictive Control (MPC) implementation for stabilizing a magnetic levitation system (maglev) where a ball is suspended in air using electromagnetic forces. The system is visualized using Pygame with real-time control.

<p align="center">
  <img src="https://github.com/VladSarm/MagneticLevitationMPC/blob/main/movie.mp4" alt="full stabilization of maglev" width="400">
</p>
<p align="center">
  <em>Full stabilization of the Magnetic Levitation system using an MPC controller</em>
</p>

## 📋 Overview

The system consists of a ball and a coil. The ball is suspended in air using electromagnetic forces. The coil is controlled by a current $u$ which is applied to the coil. The ball is subject to two primary forces:
- Gravity ($F_g = -mg$) pulling it downward
- Electromagnetic force ($F_e$) pushing it upward, generated by a current $u$ through the coil
The net force on the ball is:
$$ F_{net} = F_e - F_g = \frac{ku^2}{(x_1+ϵ)^2} - mg $$
where:
- $x_1$: vertical position (height) of the ball [m]

## 🚀 Quick Start

### Prerequisites

If you don't have [uv](https://github.com/astral-sh/uv) (a fast Python package installer and resolver) installed, run:

```bash
curl -LsSf https://astral.sh/uv/install.sh | sh
```

### Running the Simulation

To run the standard simulation with full stabilization:

```bash
uv run main.py
```

The plots and animation will be saved to `gfx/MagneticLevitationMPC/`.

To run the simulation with only the backstepping controller (without switching to PD control):

```bash
uv run main.py --backstepping-only
```

This alternative simulation output will be saved to `gfx/MagneticLevitationMPC/`.

## 🧠 Technical Background



### Physics of the Magnetic Levitation System

The ball is subject to two primary forces:

1. **Gravity** ($F_g = -mg$) pulling it downward
2. **Electromagnetic force** ($F_e$) pushing it upward, generated by a current $u$ through the coil

The net force on the ball is:

$$ F_{net} = F_e - F_g = \frac{ku^2}{(x_1+ϵ)^2} - mg $$

where:
- $x_1$: vertical position (height) of the ball [m]
- $u$: control current [A] applied to the electromagnet
- $k$: electromagnetic force constant [N·m²/A²]
- $ϵ$: small constant (ϵ=0.1) to avoid singularity when $x_1 = 0$
- $m$: mass of the ball [kg] (normalized to 1 in this simulation)
- $g$: gravitational acceleration (9.81 m/s²)

### State-Space Representation

The system dynamics can be represented as:

$$
\begin{align*}
\dot{x}_1 &= x_2 \\
\dot{x}_2 &= -g + \frac{ku^2}{(x_1+ϵ)^2}
\end{align*}
$$

where:
- $x_1$: position (height) of the ball
- $x_2$: velocity of the ball

### Discrete-Time Implementation

The continuous-time dynamics are discretized using Euler integration with timestep $Δt = 0.01s$:

$$
\begin{align*}
x_1(t+Δt) &= x_1(t) + Δt \cdot x_2(t) \\
x_2(t+Δt) &= x_2(t) + Δt \cdot \left(-g + \frac{ku(t)^2}{(x_1(t)+ϵ)^2}\right)
\end{align*}
$$

### Control Strategy in Detail

The MPC controller is implemented using CasADi. The controller predicts the future trajectory of the ball and adjusts the control input $u$ to minimize the error between the predicted and desired trajectory.

## 📊 Experiments Definition

## 📊 Results and Discussion

Eventually, the MPC controller was applied to the task of holding a metal ball at a certain height due to the magnetic field generated by the coil. 

<p align="center">
  <img src="https://github.com/VladSarm/MagneticLevitationMPC/blob/main/grafix.jpg" alt="full stabilization of maglev" width="900">
</p>
<p align="center">
  <em>Full stabilization of the Magnetic Levitation system using an MPC controller</em>
</p>

<p align="center">
  <img src="https://github.com/VladSarm/MagneticLevitationMPC/blob/main/movie.mp4" alt="full stabilization of maglev" width="400">
</p>
<p align="center">
  <em>Full stabilization of the Magnetic Levitation system using an MPC controller</em>
</p>





## 🙏 Authors
* [Egor Miroshnichenko](https://github.com/Chenkomirosh)
* [Anton Bolychev](https://github.com/antonbolychev)
* [Vladislav Sarmatin](https://github.com/VladSarm)
* [Arsenii Shavrin](https://github.com/ArseniiSh)